---
title: "Master Thesis Code"
author: "Nina van Gerwen (1860852)"
date: "2022-10-28"
output: html_document
---

## Functions for IRF calculations

These are necessary in data generation as we will vary the data generating model.

```{r}
source("Functions/model-calculations.R")
source("Functions/data-generation.R")
source("Functions/missingness.R")
source("Functions/data-aggregation.R")
source("Functions/lr-test-calculation.R")
source("Functions/chi-square-diff-test.R")
source("Functions/pearson-chi-sq-test.R")
source("Functions/start.values.R")
```

## Empirical alpha analysis

```{r Final first run}
library(ltm)
library(dplyr)
library(mirt)
## This is for empirical alpha estimation
test_length <- as.factor(c(5, 10, 20))
sample_size <- as.factor(c(200, 300)/4)
n_groups <- as.factor(c(2, 3, 4))

n_sim <- 10

## We vary three factors, and for the simulation study, we 
## cross-examine them through a nested for loop

alpha_results_two <- data.frame(test_length = NA, sample_size = NA, G = NA, MG.LR = NA)

set.seed(1248)

for(a in levels(test_length)){

  for(b in levels(sample_size)){
    
    for(d in levels(n_groups)){
      
      prop_1 <- rep(NA, n_sim)
      
      temp_n <- as.numeric(as.character(b))
      temp_k <- as.numeric(as.character(a))
      temp_g <- as.numeric(as.character(d))
      
      start.vals <- start.values(temp_k)
      
        for(i in 1:n_sim){
        ## Then, for every condition, generate data according to the
        ## current condition

          temp_data <- multigroup.data.gen(n = temp_n, k = temp_k, g = temp_g, method = "param")
            
          temp_model <- ltm(temp_data[ , 1:temp_k] ~ z1, IRT.param = TRUE)
          
          l_0 <- temp_model$log.Lik
        
          p_value_1 <- 1 - pchisq(q = MG.LR.test(l_0 = l_0, data = temp_data, g = temp_g, start.val = start.vals), 
                              df = (temp_g - 1) * 2 * temp_k)
 
          prop_1[i] <- ifelse(p_value_1 < .05, 1, 0)

        }
      
        alpha_results_two <- rbind(alpha_results_two, c(a, as.numeric(as.character(b)) * 4, d, mean(prop_1)))
      }
      

  }
  
}

alpha_results_two <- alpha_results[-1 ,]
rownames(alpha_results_two) <- NULL

alpha_results_two


##round(alpha_results_two, digits = 3)
```


## Power analysis

...